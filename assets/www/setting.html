<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>CUI-Miku Setting</title>
        <link rel="stylesheet" href="css/jquery.mobile-1.1.1.min.css" />
        <link rel="stylesheet" href="css/setting.css" />
        <script type="text/javascript" charset="utf-8" src="js/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/jquery.mobile-1.1.1.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/jquery.flicksimple.js"></script>
        <script type="text/javascript" charset="utf-8" src="cordova-2.0.0.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/childbrowser.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/SpeechRecognizer.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/MorphologicalAnalysiser.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/tts.js"></script>
        <script type="text/javascript" charset="utf-8" src="cui/config.js"></script>
        <script type="text/javascript" charset="utf-8" src="google_calendar.js"></script>
        <script type="text/javascript" charset="utf-8" src="cui/core.js"></script>
        <script type="text/javascript" charset="utf-8" src="cui/simplebot.js"></script>
        <script type="text/javascript" charset="utf-8" src="cui/function.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/setting.js"></script>
        <script type="text/javascript">
            var isDBEnable = false;
            var initValue = function(key, value) {
                if (value == true) {
                    flag = 1
                } else {
                    flag = 0
                }
                $(key)[0].options.selectedIndex = flag
                $(key).slider('refresh');
            }
            var init = function() {
                initValue("#externalapi_googlecalendar_enable", Config.load().externalApi.googleCalendar.enable)
                initValue("#etc_tts_enable ", Config.load().etc.tts.enable)
                if ( typeof device === 'undefined') {
                    console.log("unready device")
                } else {
                    document.addEventListener("deviceready", function(){isDBEnable = true }, false);
                }
            }
            var bindEvent = function() {
                $("#externalapi_googlecalendar_enable").bind("change", function(event, ui) {
                    var options = event.target.options
                    option = options[options.selectedIndex].value

                    var cal = new GoogleCalendar()
                    if (option === "on") {
                        cal.authorize(function() {
                            var config = Config.load()
                            config.externalApi.googleCalendar.enable = true
                            Config.save(config)
                            cal.getCalendarList();
                        })
                    } else {
                        cal.unauthorize()
                        var config = Config.load()
                        config.externalApi.googleCalendar.enable = false
                        Config.save(config)
                    }
                });

                $("#etc_tts_enable").bind("change", function(event, ui) {
                    var options = event.target.options
                    option = options[options.selectedIndex].value

                    if (option === "on") {
                        console.log("#etc_tts_enable on")
                        var config = Config.load()
                        config.etc.tts.enable = true
                        Config.save(config)
                    } else {
                        console.log("#etc_tts_enable off")
                        config = Config.load()
                        config.etc.tts.enable = false
                        Config.save(config)
                    }
                });

                $("#alerm_time").bind("change", function(event, ui) {
                        console.log("alerm_picker")
                        var time = $(event.target).val();
                        var config = Config.load()
                        config.event.alerm.time = $(event.target).val();
                        Config.save(config)

                        var fail = function(){
                            alert("failed file open.");
                        }

                        function gotFS(fileSystem) {
                            fileSystem.root.getDirectory('COLAS', {create: true}, function(dirEntry) {
                                dirEntry.getFile("readme.txt", {create: true, exclusive: false}, gotFileEntry, fail);
                            },fail)
                        }

                        function gotFileEntry(fileEntry) {
                            console.log("fillepath:" + fileEntry.fullPath);
                            fileEntry.createWriter(gotFileWriter, fail);
                        }
                        function gotFileWriter(writer) {
                            
                            writer.write("{this:'123'}");
                        }
                        window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
                        

                        alert($(event.target).val());
                });
            }
            $(function() {
                init()
                bindEvent()
            })
        </script>
    </head>
    <body>
        <div data-role="page" id="page1">
            <div data-theme="a" data-role="header">
                <h3> 設定画面 </h3>
            </div>
            <div data-role="content" style="padding: 15px">
                <form action="">
                    <ul data-role="listview" data-divider-theme="" data-inset="true">
                        <li data-role="list-divider" role="heading" class="ui-li ui-li-divider ui-bar-d ui-corner-top">
                            外部API
                        </li>
                        <li data-role="fieldcontain">
                            <label for="externalapi_googlecalendar_enable">Google Calendar</label>
                            <select name="externalapi_googlecalendar_enable" id="externalapi_googlecalendar_enable" data-role="slider" data-mini="true">
                                <option value="off">Off</option>
                                <option value="on">On</option>
                            </select>
                        </li>
                    </ul>
                    <ul data-role="listview" data-divider-theme="" data-inset="true">
                        <li data-role="list-divider" role="heading" class="ui-li ui-li-divider ui-bar-d ui-corner-top">
                            その他
                        </li>
                        <li data-role="fieldcontain">
                            <label for="etc_tts_enable">音声出力</label>
                            <select name="etc_tts_enable" id="etc_tts_enable" data-role="slider" data-mini="true">
                                <option value="off">Off</option>
                                <option value="on">On</option>
                            </select>
                        </li>
                    </ul>
                    <ul data-role="listview" data-divider-theme="" data-inset="true">
                        <li data-role="list-divider" role="heading" class="ui-li ui-li-divider ui-bar-d ui-corner-top">
                            イベント
                        </li>
                        <li data-role="fieldcontain">
                            <label for="alerm">Alerm</label>
                            <input id="alerm_time" type="time" name="alerm_time" value="" />
                        </li>
                    </ul>
                </form>
            </div>
        </div>
        <script>
            //App custom javascript
        </script>
    </body>
</html>

// Generated by CoffeeScript 1.6.3
(function() {
  var showRss;

  window.Function = {};

  showRss = function(flickWindow, url) {
    $.get(url, function(res, code) {
      var items, xml;
      xml = $(res);
      items = xml.find("item").map(function(i, x) {
        return {
          title: $(x).find("title").text(),
          link: $(x).find("link").text(),
          description: $(x).find("description").text()
        };
      });
      return items.each(function(i, item) {
        return flickWindow.add(item.title, item.link, item.description.slice(0, 60));
      });
    });
    return flickWindow.show();
  };

  Function.showNews = function(flickWindow) {
    var url;
    url = "https://twitter.com/statuses/user_timeline/82492709.rss";
    url = "http://feeds.feedburner.com/hatena/b/hotentry";
    return showRss(flickWindow, url);
  };

  Function.searchMap = function(keyword) {
    var url;
    url = 'http://maps.google.co.jp/maps?q=' + encodeURIComponent(keyword) + '&hl=ja&ie=UTF8&sll=' + window.Location.latitude + "," + window.Location.longitude + '&ll=' + window.Location.latitude + "," + window.Location.longitude;
    console.log("searchMap:url=" + url);
    return window.open(url);
  };

  Function.showSchedule = function(date, success, fail) {
    var cal, items;
    console.log("getschedule:date=" + date);
    cal = new GoogleCalendar();
    return items = cal.getCalendarList(function(items) {
      var end_datetime, start_datetime;
      start_datetime = date.toFormat('YYYY-MM-DD') + 'T00:00:00Z';
      end_datetime = date.addDays(1).toFormat('YYYY-MM-DD') + 'T00:00:00Z';
      return cal.getEventList(items[1].id, start_datetime, end_datetime, function(data) {
        var detail, e_datetime, flickWindow, item, place, s_datetime;
        items = data.items;
        window.items2 = items;
        if (items != null) {
          success();
          item = items[0];
          s_datetime = item.start.dateTime.replace(":00+09:00", "");
          e_datetime = item.end.dateTime.replace(":00+09:00", "");
          place = item.location != null ? item.location : "なし";
          detail = $("<table />");
          detail.append($("<tr />").append("<th>開始:</th>").append("<td>" + s_datetime + "</td>"));
          detail.append($("<tr />").append("<th>終了:</th>").append("<td>" + e_datetime + "</td>"));
          detail.append($("<tr />").append("<th>場所:</th>").append("<td>" + place + "</td>"));
          flickWindow = new FlickWindow(180, 300);
          flickWindow.add(item.summary, item.htmlLink, "<table>" + detail.html() + "</table>");
          return flickWindow.show();
        } else {
          console.log("not found schedule.");
          return fail();
        }
      });
    });
  };

}).call(this);
